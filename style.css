/* ========================================
   Modern Chat Application - Complete Redesign (Restored)
   ======================================== */

:root {
  /* Colors */
  --primary-gradient: linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  --secondary-gradient: linear-gradient(135deg,#f093fb 0%,#f5576c 100%);
  --accent-gradient: linear-gradient(135deg,#4facfe 0%,#00f2fe 100%);
  
  --bg-dark:#0a0e27;
  --bg-darker:#070b1f;
  --surface:rgba(255,255,255,.05);
  --surface-hover:rgba(255,255,255,.08);
  --glass:rgba(255,255,255,.03);
  --glass-border:rgba(255,255,255,.1);
  
  --text-primary:#fff;
  --text-secondary:rgba(255,255,255,.7);
  --text-muted:rgba(255,255,255,.4);
  
  --user-msg-bg:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
  --bot-msg-bg:rgba(255,255,255,.05);
  
  --success:#10b981;
  --error:#ef4444;
  --warning:#f59e0b;
  
  /* Spacing */
  --sidebar-width:280px;
  --header-height:80px;
  --input-height:120px;
  
  /* Border Radius */
  --radius-sm:8px;
  --radius-md:12px;
  --radius-lg:16px;
  --radius-xl:24px;
  --radius-full:999px;
  
  /* Shadows */
  --shadow-sm:0 2px 8px rgba(0,0,0,.1);
  --shadow-md:0 4px 16px rgba(0,0,0,.2);
  --shadow-lg:0 8px 32px rgba(0,0,0,.3);
  --shadow-glow:0 0 40px rgba(102,126,234,.4);
  
  /* Transitions */
  --transition:all .3s cubic-bezier(.4,0,.2,1);
}

* { margin:0; padding:0; box-sizing:border-box; }
html,body { height:100%; overflow:hidden; }
body { font-family:-apple-system,BlinkMacSystemFont,'Segoe UI','Roboto','Oxygen','Ubuntu',sans-serif; background:var(--bg-darker); color:var(--text-primary); line-height:1.6; -webkit-font-smoothing:antialiased; }

/* ========================================
   Loading Screen
   ======================================== */

#loading-screen { position:fixed; inset:0; background:linear-gradient(135deg,#0a0e27,#1a1f3a); display:flex; align-items:center; justify-content:center; z-index:9999; transition:opacity .5s ease,visibility .5s ease; }
#loading-screen.hidden { opacity:0; visibility:hidden; }
.loader-wrapper { text-align:center; }
.modern-loader { position:relative; width:120px; height:120px; margin:0 auto 24px; }
.loader-ring { position:absolute; width:100%; height:100%; border:3px solid transparent; border-top-color:#667eea; border-radius:50%; animation:spin 1.5s cubic-bezier(.68,-.55,.265,1.55) infinite; }
.loader-ring:nth-child(2){ width:80%; height:80%; top:10%; left:10%; border-top-color:#764ba2; animation-delay:-.5s; }
.loader-ring:nth-child(3){ width:60%; height:60%; top:20%; left:20%; border-top-color:#f093fb; animation-delay:-1s; }
@keyframes spin { to { transform:rotate(360deg); } }
.loader-text { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); font-size:18px; font-weight:600; background:var(--primary-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.loading-status { font-size:14px; color:var(--text-secondary); animation:pulse 2s ease-in-out infinite; }
@keyframes pulse { 0%,100%{opacity:.5;} 50%{opacity:1;} }

/* ========================================
   Main Layout
   ======================================== */

#main-app { display:flex; height:100vh; opacity:0; transition:opacity .5s ease; position:relative; overflow:hidden; }
#main-app.visible { opacity:1; }
.bg-gradient { position:absolute; inset:0; background:linear-gradient(135deg,#0a0e27 0%,#1a1f3a 50%,#0a0e27 100%); z-index:0; }
.bg-mesh { position:absolute; inset:0; overflow:hidden; z-index:1; }
.mesh-dot { position:absolute; width:400px; height:400px; border-radius:50%; filter:blur(80px); opacity:.3; animation:float 20s ease-in-out infinite; }
.mesh-dot:nth-child(1){ background:radial-gradient(circle,#667eea 0%,transparent 70%); top:-10%; left:-10%; }
.mesh-dot:nth-child(2){ background:radial-gradient(circle,#764ba2 0%,transparent 70%); top:60%; right:-10%; animation-delay:-5s; }
.mesh-dot:nth-child(3){ background:radial-gradient(circle,#f093fb 0%,transparent 70%); bottom:-10%; left:50%; animation-delay:-10s; }
.mesh-dot:nth-child(4){ background:radial-gradient(circle,#4facfe 0%,transparent 70%); top:20%; right:20%; animation-delay:-15s; }
@keyframes float { 0%,100%{transform:translate(0,0) scale(1);} 33%{transform:translate(30px,-30px) scale(1.1);} 66%{transform:translate(-20px,20px) scale(.9);} }

/* ========================================
   Sidebar
   ======================================== */

.sidebar { width:var(--sidebar-width); background:var(--glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-right:1px solid var(--glass-border); display:flex; flex-direction:column; z-index:10; position:relative; }
.sidebar-header { padding:24px 20px; border-bottom:1px solid var(--glass-border); }
.app-logo { display:flex; align-items:center; gap:12px; }
.logo-circle { width:48px; height:48px; background:var(--glass); border:2px solid var(--glass-border); border-radius:var(--radius-md); display:flex; align-items:center; justify-content:center; transition:var(--transition); }
.logo-circle:hover { background:var(--surface-hover); box-shadow:var(--shadow-glow); }
.app-name { flex:1; }
.name-primary { font-size:20px; font-weight:700; background:var(--primary-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.name-sub { font-size:12px; color:var(--text-muted); margin-top:2px; }
.sidebar-nav { padding:20px 12px; flex:1; }
.nav-item { width:100%; display:flex; align-items:center; gap:12px; padding:12px 16px; background:transparent; border:none; border-radius:var(--radius-md); color:var(--text-secondary); font-size:15px; cursor:pointer; transition:var(--transition); margin-bottom:8px; }
.nav-item:hover { background:var(--surface-hover); color:var(--text-primary); }
.nav-item.active { background:var(--primary-gradient); color:#fff; box-shadow:var(--shadow-md); }
.sidebar-footer { padding:20px; border-top:1px solid var(--glass-border); }
.user-profile { display:flex; align-items:center; gap:12px; padding:12px; background:var(--glass); border-radius:var(--radius-md); border:1px solid var(--glass-border); transition:var(--transition); }
.user-profile:hover { background:var(--surface-hover); }
.profile-avatar { width:40px; height:40px; border-radius:var(--radius-md); object-fit:cover; border:2px solid var(--glass-border); }
.profile-info { flex:1; }
.profile-name { font-size:14px; font-weight:600; color:var(--text-primary); }
.profile-status { font-size:12px; color:var(--text-muted); display:flex; align-items:center; gap:6px; margin-top:2px; }
.status-dot-mini { width:6px; height:6px; background:var(--success); border-radius:50%; box-shadow:0 0 8px var(--success); }

/* ========================================
   Main Content
   ======================================== */

.main-content { flex:1; display:flex; flex-direction:column; position:relative; z-index:2; overflow:hidden; }

/* Header */
.modern-header { height:var(--header-height); padding:20px 32px; display:flex; align-items:center; justify-content:space-between; background:var(--glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-bottom:1px solid var(--glass-border); gap:24px; }
.header-info { flex:1; min-width:200px; }
.header-title { font-size:24px; font-weight:700; margin:0; line-height:1.2; }
.header-subtitle { font-size:13px; color:var(--text-muted); margin-top:4px; }
.header-actions { display:flex; align-items:center; gap:16px; flex-shrink:0; }

/* Spotify Widget */
.spotify-widget { position:relative; display:flex; align-items:center; }
.spotify-connect-btn { display:flex; align-items:center; gap:8px; padding:12px 24px; background:#1DB954; border:none; border-radius:var(--radius-full); color:#fff; font-size:14px; font-weight:600; cursor:pointer; transition:var(--transition); box-shadow:var(--shadow-md); white-space:nowrap; }
.spotify-connect-btn:hover { transform:translateY(-2px); box-shadow:var(--shadow-lg); }
.spotify-player-active { display:flex; align-items:center; gap:12px; padding:8px 16px 8px 8px; background:var(--glass); border:1px solid var(--glass-border); border-radius:var(--radius-full); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); min-width:350px; max-width:450px; }
.spotify-album-art { width:48px; height:48px; position:relative; border-radius:var(--radius-md); overflow:hidden; flex-shrink:0; }
.spotify-album-art img { width:100%; height:100%; object-fit:cover; }
.album-overlay { position:absolute; inset:0; background:rgba(0,0,0,.4); display:flex; align-items:center; justify-content:center; opacity:0; transition:var(--transition); }
.spotify-album-art:hover .album-overlay { opacity:1; }
.spotify-track-info { flex:1; min-width:0; max-width:200px; }
.track-name { font-size:13px; font-weight:600; color:var(--text-primary); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.track-artist { font-size:12px; color:var(--text-muted); white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
.spotify-controls-modern { display:flex; align-items:center; gap:4px; flex-shrink:0; }
.control-btn { width:32px; height:32px; background:transparent; border:none; border-radius:var(--radius-sm); color:var(--text-secondary); cursor:pointer; display:flex; align-items:center; justify-content:center; transition:var(--transition); }
.control-btn:hover { background:var(--surface-hover); color:var(--text-primary); }
.control-btn-play { width:36px; height:36px; background:var(--primary-gradient); color:#fff; }
.control-btn-play:hover { transform:scale(1.1); box-shadow:var(--shadow-glow); }

/* ========================================
   Messages Container
   ======================================== */

.messages-container { flex:1; overflow-y:auto; overflow-x:hidden; padding:32px; scroll-behavior:smooth; }
.messages-container::-webkit-scrollbar { width:8px; }
.messages-container::-webkit-scrollbar-track { background:transparent; }
.messages-container::-webkit-scrollbar-thumb { background:var(--glass-border); border-radius:var(--radius-full); }
.messages-container::-webkit-scrollbar-thumb:hover { background:var(--surface-hover); }

/* Welcome Card */
.welcome-card { max-width:600px; margin:60px auto; text-align:center; padding:48px; background:var(--glass); border:1px solid var(--glass-border); border-radius:var(--radius-xl); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); animation:fadeInUp .6s ease; }
@keyframes fadeInUp { from{opacity:0; transform:translateY(30px);} to{opacity:1; transform:translateY(0);} }
.welcome-icon-modern { width:80px; height:80px; margin:0 auto 24px; background:var(--primary-gradient); border-radius:var(--radius-xl); display:flex; align-items:center; justify-content:center; box-shadow:var(--shadow-glow); animation:float 3s ease-in-out infinite; }
.welcome-title { font-size:32px; font-weight:700; margin:0 0 12px; background:var(--primary-gradient); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
.welcome-desc { font-size:16px; color:var(--text-secondary); margin:0 0 32px; line-height:1.6; }
.quick-actions { display:flex; gap:12px; justify-content:center; flex-wrap:wrap; }
.quick-action-chip { padding:10px 20px; background:var(--surface); border:1px solid var(--glass-border); border-radius:var(--radius-full); font-size:14px; color:var(--text-secondary); cursor:pointer; transition:var(--transition); }
.quick-action-chip:hover { background:var(--primary-gradient); color:#fff; transform:translateY(-2px); box-shadow:var(--shadow-md); }

/* Message Bubbles */
.message { display:flex; gap:12px; margin-bottom:24px; animation:slideIn .3s ease; }
@keyframes slideIn { from{opacity:0; transform:translateY(10px);} to{opacity:1; transform:translateY(0);} }
.message.user { flex-direction:row-reverse; }
.message-avatar { width:40px; height:40px; border-radius:var(--radius-md); background:var(--primary-gradient); display:flex; align-items:center; justify-content:center; font-size:20px; flex-shrink:0; box-shadow:var(--shadow-md); }
.message.bot .message-avatar { background:var(--glass); border:1px solid var(--glass-border); }
.message-content { flex:1; max-width:70%; }
.message-bubble { padding:16px 20px; border-radius:var(--radius-lg); font-size:15px; line-height:1.6; word-wrap:break-word; backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); }
.message.user .message-bubble { background:var(--user-msg-bg); color:#fff; box-shadow:var(--shadow-md); }
.message.bot .message-bubble { background:var(--bot-msg-bg); border:1px solid var(--glass-border); color:var(--text-primary); }
.message-time { font-size:12px; color:var(--text-muted); margin-top:8px; padding:0 8px; }

/* Typing Indicator */
.typing-indicator { display:flex; gap:12px; margin-bottom:24px; }
.typing-bubble { padding:16px 20px; background:var(--bot-msg-bg); border:1px solid var(--glass-border); border-radius:var(--radius-lg); display:flex; gap:6px; }
.typing-dot { width:8px; height:8px; background:var(--text-muted); border-radius:50%; animation:typing 1.4s infinite; }
.typing-dot:nth-child(2){ animation-delay:.2s; }
.typing-dot:nth-child(3){ animation-delay:.4s; }
@keyframes typing { 0%,60%,100%{opacity:.3; transform:translateY(0);} 30%{opacity:1; transform:translateY(-10px);} }

/* ========================================
   Input Section
   ======================================== */

.input-section { padding:24px 32px; background:var(--glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border-top:1px solid var(--glass-border); }
.input-container { display:flex; align-items:flex-end; gap:12px; padding:12px; background:var(--surface); border:2px solid var(--glass-border); border-radius:var(--radius-xl); transition:var(--transition); }
.input-container:focus-within { border-color:#667eea; box-shadow:0 0 0 4px rgba(102,126,234,.1); }
.input-action-btn { width:40px; height:40px; background:transparent; border:none; border-radius:var(--radius-md); color:var(--text-muted); cursor:pointer; display:flex; align-items:center; justify-content:center; transition:var(--transition); flex-shrink:0; }
.input-action-btn:hover { background:var(--surface-hover); color:var(--text-primary); }
.modern-input { flex:1; background:transparent; border:none; outline:none; color:var(--text-primary); font-size:15px; font-family:inherit; resize:none; max-height:120px; line-height:1.5; padding:8px 0; }
.modern-input::placeholder { color:var(--text-muted); }
.send-btn-modern { width:44px; height:44px; background:var(--primary-gradient); border:none; border-radius:var(--radius-md); color:#fff; cursor:pointer; display:flex; align-items:center; justify-content:center; transition:var(--transition); flex-shrink:0; box-shadow:var(--shadow-md); }
.send-btn-modern:hover { transform:translateY(-2px); box-shadow:var(--shadow-glow); }
.send-btn-modern:active { transform:translateY(0); }
.send-btn-modern.sending { animation:pulse 1s ease-in-out infinite; }
.input-footer { display:flex; justify-content:space-between; align-items:center; margin-top:12px; padding:0 8px; }
.input-hint { font-size:12px; color:var(--text-muted); }

/* ========================================
   Toast Notifications
   ======================================== */

#toast-container { position:fixed; top:24px; right:24px; z-index:9998; display:flex; flex-direction:column; gap:12px; }
.toast { min-width:300px; padding:16px 20px; background:var(--glass); backdrop-filter:blur(20px); -webkit-backdrop-filter:blur(20px); border:1px solid var(--glass-border); border-radius:var(--radius-md); color:var(--text-primary); font-size:14px; box-shadow:var(--shadow-lg); opacity:0; transform:translateX(100px); transition:var(--transition); }
.toast.show { opacity:1; transform:translateX(0); }
.toast.hide { opacity:0; transform:translateX(100px); }
.toast-error { border-left:4px solid var(--error); }
.toast-success { border-left:4px solid var(--success); }
.toast-warning { border-left:4px solid var(--warning); }

/* ========================================
   Scroll to Bottom Button
   ======================================== */

.scroll-btn { position:fixed; bottom:calc(var(--input-height) + 24px); right:32px; width:48px; height:48px; background:var(--primary-gradient); border:none; border-radius:50%; color:#fff; cursor:pointer; box-shadow:var(--shadow-lg); z-index:100; transition:var(--transition); opacity:0; pointer-events:none; }
.scroll-btn:not([hidden]) { opacity:1; pointer-events:all; }
.scroll-btn:hover { transform:translateY(-4px); box-shadow:var(--shadow-glow); }
.scroll-btn:active { transform:translateY(-2px); }

/* ========================================
   Message Actions
   ======================================== */

.message { position:relative; }
.message-actions { position:absolute; top:-12px; right:12px; display:flex; gap:6px; opacity:0; transition:var(--transition); }
.message:hover .message-actions { opacity:1; }
.msg-action-btn { background:var(--surface); border:1px solid var(--glass-border); border-radius:var(--radius-sm); padding:6px; cursor:pointer; color:var(--text-secondary); transition:var(--transition); display:flex; align-items:center; justify-content:center; }
.msg-action-btn:hover { background:var(--surface-hover); color:var(--text-primary); transform:translateY(-2px); }

/* ========================================
   Voice Input Recording State
   ======================================== */

#voice-btn.recording { background:var(--error); color:#fff; animation:pulse-recording 1.5s ease-in-out infinite; }
@keyframes pulse-recording { 0%,100%{opacity:1;} 50%{opacity:.6;} }

/* ========================================
   Light Theme
   ======================================== */

[data-theme="light"] {
  --bg-dark:#f5f7fa;
  --bg-darker:#ffffff;
  --surface:rgba(0,0,0,.03);
  --surface-hover:rgba(0,0,0,.06);
  --glass:rgba(255,255,255,.8);
  --glass-border:rgba(0,0,0,.1);
  --text-primary:#1a1a1a;
  --text-secondary:rgba(0,0,0,.7);
  --text-muted:rgba(0,0,0,.4);
  --bot-msg-bg:rgba(0,0,0,.05);
}

[data-theme="light"] .bg-gradient { background:linear-gradient(135deg,#f5f7fa 0%,#e8ecf1 50%,#f5f7fa 100%); }
[data-theme="light"] .mesh-dot { opacity:.15; }
[data-theme="light"] .loader-ring { border-top-color:#667eea; }
[data-theme="light"] .message.bot .message-bubble { color:#1a1a1a; }

/* ========================================
   Responsive Design
   ======================================== */

@media (max-width:1200px){ 
  .spotify-track-info{ max-width:150px; } 
  .spotify-player-active{ max-width:380px; }
}

@media (max-width:1024px){ 
  :root{ --sidebar-width:240px; } 
  .spotify-track-info{ max-width:120px; } 
  .spotify-player-active{ max-width:320px; }
  .header-title{ font-size:20px; }
}

@media (max-width:768px){ 
  .sidebar{ position:fixed; left:-100%; height:100vh; z-index:100; transition:var(--transition); } 
  .sidebar.open{ left:0; } 
  .main-content{ width:100%; } 
  .modern-header{ height:auto; min-height:var(--header-height); padding:16px; flex-direction:column; align-items:stretch; gap:16px; } 
  .header-info{ min-width:auto; }
  .header-title{ font-size:20px; }
  .header-actions{ width:100%; justify-content:center; }
  .spotify-widget{ width:100%; }
  .spotify-connect-btn{ width:100%; justify-content:center; }
  .spotify-player-active{ min-width:auto; max-width:100%; width:100%; }
  .spotify-track-info{ max-width:none; flex:1; }
  .messages-container{ padding:16px; } 
  .input-section{ padding:16px; } 
  .message-content{ max-width:85%; } 
  .welcome-card{ padding:32px 24px; margin:32px auto; } 
  #toast-container{ right:16px; left:16px; } 
  .toast{ min-width:auto; } 
  .scroll-btn{ right:16px; bottom:calc(var(--input-height) + 16px); } 
  .message-actions{ top:-8px; right:8px; } 
}

/* ========================================
   Accessibility
   ======================================== */

@media (prefers-reduced-motion:reduce){ *,*::before,*::after{ animation-duration:.01ms !important; animation-iteration-count:1 !important; transition-duration:.01ms !important; } }
*:focus-visible,button:focus-visible { outline:2px solid #667eea; outline-offset:2px; }
